import artel
import artel.js

external
{
  type F<T> = operation (): T

  // Transaction

  #ВнешняяРеализация(модуль = "reactronic")
  type Transaction = /*(!) abstract */ object
  based on Worker
  {
    /*(!) abstract */
    protected
    id: Integer

    /*(!) abstract */
    protected
    hint: Текст

    /*(!) abstract */
    protected
    options: SnapshotOptions

    /*(!) abstract */
    protected
    timestamp: Integer

    /*(!) abstract */
    protected
    error`: Error?

    /*(!) abstract */
    protected
    changeset: Changeset

    /*(!) abstract */
    protected
    margin: Integer

    // #js.МассивПараметров
    // /*(!) abstract */ 
    // operation run<T>(func: F<T>, args: List</*(!) any */ Object?>): T

    #js.МассивПараметров
    /*(!) abstract */ 
    operation inspect<T>(func: F<T>, args: List</*(!) any */ Object?>): T

    /*(!) abstract */ 
    operation apply()

    /*(!) abstract */ 
    operation seal(): /*(!) any */ Object?

    /*(!) abstract */ 
    operation wrap<T>(func: F<T>, secondary: Boolean): F<T>

    /*(!) abstract */ 
    operation cancel(error`: Error, retryAfterOrIgnore: Worker? = empty): Object?

    /*(!) abstract */
    protected
    isCanceled: Boolean

    /*(!) abstract */
    protected
    isFinished: Boolean

    параллельная
    operation whenFinished(): Promise<Void>

    global 
    operation create(options: SnapshotOptions?): Transaction

    #js.МассивПараметров
    global 
    operation run<T>(options: SnapshotOptions?, func: operation (): T, args: List<Object?>): T

    #js.МассивПараметров
    global 
    operation separate<T>(func: F<T>, args: List</*(!) any */ Object?>): T

    #js.МассивПараметров
    global 
    operation outside<T>(func: F<T>, args: List</*(!) any */ Object?>): T

    global 
    operation isFrameOver(everyN: Integer = 1, timeLimit: Integer = 10): Boolean

    global 
    operation requestNextFrame(sleepTime: Integer = 0): Promise<Void>

    protected
    current: Transaction

    protected
    isCanceled: Boolean
  }
}
